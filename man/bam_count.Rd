% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bam_read.R
\name{bam_count}
\alias{bam_count}
\title{Count BAM records with Bioconductor-compatible filtering}
\usage{
bam_count(
  file,
  param = NULL,
  threads = 1L,
  BPPARAM = NULL,
  auto_threads = FALSE,
  include_unmapped = TRUE
)
}
\arguments{
\item{file}{BAM input (\code{character}, \code{BamFile}, or \code{BamFileList}).}

\item{param}{Optional \code{Rsamtools::ScanBamParam} (or compatible list).}

\item{threads}{Requested number of OpenMP threads. May be capped when
\code{auto_threads = TRUE}.}

\item{BPPARAM}{Optional \code{BiocParallel} parameter for multi-file operation.}

\item{auto_threads}{Logical; when \code{TRUE} and \code{BPPARAM} has multiple workers,
BamScale automatically caps per-file OpenMP threads to avoid
oversubscription.}

\item{include_unmapped}{Whether to include an extra \code{*} row for unmapped
records.}
}
\value{
For one file: a \code{data.frame} with columns \code{seqname}, \code{seqlength}, \code{count}.
For multiple files: named list of such \code{data.frame}s.
}
\description{
\code{bam_count()} provides a fast chromosome-level count summary, honoring key
filtering fields from \code{ScanBamParam} (\code{mapqFilter}, \code{flag}, and \code{which}).
}
\details{
Parallelism behavior matches \code{bam_read()}: \code{BPPARAM} distributes work across
BAM files, while \code{threads} controls OpenMP work within each file. If
\code{auto_threads = TRUE} and \code{BPPARAM} has multiple workers, per-file OpenMP
threads are capped using
\code{max(1, min(threads, floor(available_cores / workers_eff)))}, where
\code{workers_eff = min(length(file), BiocParallel::bpnworkers(BPPARAM))}.
}
\examples{
if (requireNamespace("ompBAM", quietly = TRUE)) {
  bam <- ompBAM::example_BAM("Unsorted")
  bam_count(bam, threads = 2)
}
}
